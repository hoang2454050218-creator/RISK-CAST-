---
# RISKCAST Secrets Configuration
# NOTE: In production, use External Secrets Operator or Sealed Secrets
# This file is for reference only - DO NOT commit with real values

# Using External Secrets Operator with AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: riskcast-secrets
  namespace: riskcast
  labels:
    app: riskcast
spec:
  refreshInterval: 1h
  
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secrets-manager
  
  target:
    name: riskcast-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app: riskcast
  
  data:
    # Database credentials
    - secretKey: database-url
      remoteRef:
        key: riskcast/production/database
        property: url
    
    # Redis credentials
    - secretKey: redis-url
      remoteRef:
        key: riskcast/production/redis
        property: url
    
    # Encryption key for PII
    - secretKey: encryption-key
      remoteRef:
        key: riskcast/production/encryption
        property: master-key
    
    # Twilio credentials
    - secretKey: twilio-account-sid
      remoteRef:
        key: riskcast/production/twilio
        property: account-sid
    
    - secretKey: twilio-auth-token
      remoteRef:
        key: riskcast/production/twilio
        property: auth-token
    
    - secretKey: twilio-whatsapp-number
      remoteRef:
        key: riskcast/production/twilio
        property: whatsapp-number
    
    # API keys for external services
    - secretKey: polymarket-api-key
      remoteRef:
        key: riskcast/production/polymarket
        property: api-key
    
    - secretKey: ais-api-key
      remoteRef:
        key: riskcast/production/ais
        property: api-key

---
# ClusterSecretStore for AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: aws-secrets-manager
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: external-secrets-sa
            namespace: external-secrets

---
# Alternative: Sealed Secrets (for GitOps)
# Use kubeseal to encrypt secrets before committing
# Example:
# kubeseal --format=yaml --cert=sealed-secrets.crt < secret.yaml > sealed-secret.yaml

# apiVersion: bitnami.com/v1alpha1
# kind: SealedSecret
# metadata:
#   name: riskcast-secrets
#   namespace: riskcast
# spec:
#   encryptedData:
#     database-url: AgA...encrypted...
#     redis-url: AgA...encrypted...

---
# ConfigMap for non-sensitive configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: riskcast-config
  namespace: riskcast
  labels:
    app: riskcast
data:
  # Application settings
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"
  LOG_FORMAT: "json"
  
  # Feature flags
  FEATURE_OUTCOME_TRACKING: "true"
  FEATURE_CONFIDENCE_CALIBRATION: "true"
  
  # Rate limiting defaults
  RATE_LIMIT_PER_MINUTE: "60"
  RATE_LIMIT_PER_HOUR: "1000"
  
  # Chokepoints configuration
  ENABLED_CHOKEPOINTS: "red_sea,suez,panama,malacca"
  
  # Alert settings
  ALERT_COOLDOWN_MINUTES: "30"
  
  # OpenTelemetry
  OTEL_TRACES_SAMPLER: "parentbased_traceidratio"
  OTEL_TRACES_SAMPLER_ARG: "0.1"
